#!/bin/bash
# Pre-commit hook to detect sensitive information

# „Çª„É≥„Ç∑„ÉÜ„Ç£„ÉñÊÉÖÂ†±„ÅÆ„Éë„Çø„Éº„É≥
PATTERNS=(
    "AIzaSy[A-Za-z0-9_-]{33}"  # Google API Key
    "AKIA[0-9A-Z]{16}"          # AWS Access Key ID
    "ghp_[A-Za-z0-9]{36}"       # GitHub Personal Access Token
    "gho_[A-Za-z0-9]{36}"       # GitHub OAuth Token
    "sk-[A-Za-z0-9]{48}"        # OpenAI API Key
    "-----BEGIN.*PRIVATE KEY-----"  # Private Key
    "password\s*=\s*['\"][^'\"]{8,}['\"]"  # Password in config
    "api_key\s*=\s*['\"][^'\"]{20,}['\"]"  # API Key in config
    "secret\s*=\s*['\"][^'\"]{20,}['\"]"   # Secret in config
)

# „Ç´„É©„Éº„Ç≥„Éº„Éâ
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Ê§úÂá∫„Éï„É©„Ç∞
DETECTED=0

echo "üîç Checking for sensitive information..."

# „Ç≥„Éü„ÉÉ„Éà„Åï„Çå„Çã„Éï„Ç°„Ç§„É´„Çí„ÉÅ„Çß„ÉÉ„ÇØ
for pattern in "${PATTERNS[@]}"; do
    FILES=$(git diff --cached --name-only --diff-filter=ACM)

    for file in $FILES; do
        # „Éê„Ç§„Éä„É™„Éï„Ç°„Ç§„É´„Çí„Çπ„Ç≠„ÉÉ„Éó
        if file "$file" | grep -q "text"; then
            MATCHES=$(git diff --cached "$file" | grep -E "$pattern" || true)

            if [ -n "$MATCHES" ]; then
                if [ $DETECTED -eq 0 ]; then
                    echo ""
                    echo -e "${RED}‚ö†Ô∏è  WARNING: Potential sensitive information detected!${NC}"
                    echo ""
                fi
                DETECTED=1
                echo -e "${YELLOW}File: $file${NC}"
                echo -e "${RED}Pattern: $pattern${NC}"
                echo ""
            fi
        fi
    done
done

if [ $DETECTED -eq 1 ]; then
    echo -e "${RED}‚ùå Commit blocked!${NC}"
    echo ""
    echo "Please remove sensitive information before committing."
    echo "If this is a false positive, you can bypass this check with:"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

echo "‚úÖ No sensitive information detected."
exit 0
